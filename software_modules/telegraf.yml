# install telegraf thru aur
# - include_tasks: tasks/aur.yml pkg_name="telegraf-bin"

- group:
    name: gpio
    state: present
    system: yes

- user:
    append: yes
    name: telegraf
    groups: gpio

- name: template config out
  template:
    src: templates/telegraf.conf.j2
    dest: /etc/telegraf/telegraf.conf

- name: stop service
  service:
    name: telegraf
    state: stopped
    daemon_reload: yes
  ignore_errors: yes

- name: copy dhtsensor program
  copy:
    src: dhtsensor
    dest: /usr/local/bin/dhtsensor
    mode: 0755

- name: copy udev rules
  copy:
    src: 99-gpio.rules
    dest: /etc/udev/rules.d/99-gpio.rules

- name: restart telegraf service
  service:
    name: telegraf
    state: restarted
    enabled: yes
    daemon_reload: yes

- name: restart eyepi service
  service:
    name: eyepi-capture
    state: restarted
    enabled: yes
    daemon_reload: yes
  ignore_errors: yes
